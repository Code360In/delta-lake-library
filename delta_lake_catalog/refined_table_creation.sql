CREATE TABLE IF NOT EXISTS refined.transaction (
    _kafka_topic string,
    _kafka_partition int,
    _kafka_offset bigint,
    _kafka_timestamp timestamp,
    _kafka_timestampType int,
    clientId string NOT NULL,
    clientTransactionId string,
    clientCustomerId string,
    clientPaymentSourceId string,
    _raw_change_type string,
    _raw_commit_version bigint,
    _raw_commit_timestamp timestamp,
    transaction_date date,
    paymentStore_storeId string,
    paymentStore_storeName string,
    paymentStore_categoryCode string,
    paymentStore_mcgCode string,
    paymentStore_mcgDescription string,
    paymentStore_mcgIcon string,
    paymentStore_acquirerBin string,
    paymentStore_cardAcceptorId string,
    paymentStore_address1 string,
    paymentStore_address2 string,
    paymentStore_city string,
    paymentStore_state string,
    paymentStore_zipCode string,
    paymentStore_countryCode string,
    paymentStore_Store_createdBy string,
    paymentStore_Store_createdDate timestamp,
    paymentStore_Store_lastModifiedBy string,
    paymentStore_Store_lastModifiedDate timestamp,
    paymentStore_Store_id string,
    paymentStore_Store_name string,
    paymentStore_Store_status string,
    paymentStore_Store_location_longitude string,
    paymentStore_Store_location_latitude string,
    paymentStore_Store_address_address1 string,
    paymentStore_Store_address_address2 string,
    paymentStore_Store_address_address3 string,
    paymentStore_Store_address_city string,
    paymentStore_Store_address_state string,
    paymentStore_Store_address_zipCode string,
    paymentStore_Store_address_countryCode string,
    paymentStore_Merchant_createdBy string,
    paymentStore_Merchant_createdDate timestamp,
    paymentStore_Merchant_lastModifiedBy string,
    paymentStore_Merchant_lastModifiedDate timestamp,
    paymentStore_Merchant_id string,
    paymentStore_Merchant_name string,
    paymentStore_Merchant_displayName string,
    paymentStore_Merchant_code string,
    paymentStore_Merchant_merchantLogoAssetId string,
    paymentStore_Merchant_status string,
    paymentStore_Merchant_website string,
    paymentStore_Merchant_contactName string,
    paymentStore_Merchant_contactEmail string,
    paymentStore_Merchant_locale string,
    paymentStore_Merchant_address_address1 string,
    paymentStore_Merchant_address_address2 string,
    paymentStore_Merchant_address_address3 string,
    paymentStore_Merchant_address_city string,
    paymentStore_Merchant_address_state string,
    paymentStore_Merchant_address_zipCode string,
    paymentStore_Merchant_address_countryCode string,
    paymentSource_externalId string,
    paymentSource_par string,
    paymentSource_last4Digits string,
    paymentSource_paymentSourceProduct string,
    paymentSource_paymentFundingSource string,
    paymentSource_paymentSourceNetwork string,
    paymentSource_paymentMethod string,
    paymentSource_bin string,
    paymentSource_cardArtWork string,
    transaction_createdBy string,
    transaction_createdDate timestamp,
    transaction_lastModifiedBy string,
    transaction_lastModifiedDate timestamp,
    transaction_id string,
    transaction_clientId string,
    transaction_clientCode string,
    transaction_eventId string,
    transaction_clientTransactionId string,
    transaction_networkTransactionId string,
    transaction_time timestamp,
    transaction_state string,
    transaction_clientCustomerId string,
    transaction_homeCurrency string,
    transaction_homeAmount double,
    transaction_merchantCurrency string,
    transaction_merchantAmount double,
    transaction_savedInKafka boolean,
    transaction_receiptLinkingKey string
    )
USING DELTA
PARTITIONED BY (clientId, transaction_date)
LOCATION '/mnt/refined/transaction'
TBLPROPERTIES (
    delta.enableChangeDataFeed = true,
    delta.autoOptimize.optimizeWrite = true,
    delta.autoOptimize.autoCompact = true);
